# AI 大模型接入说明

## ✅ 已完成

### 1. 创建了 OpenRouter 服务模块
- 文件：`services/geminiService.ts`
- 使用 **Grok 4.1 Fast (免费)** 模型
- 平台：OpenRouter
- 模型ID：`x-ai/grok-4.1-fast:free`
- API端点：`https://openrouter.ai/api/v1/chat/completions`

### 2. 功能特性
- **智能分析**：基于实际面相/手相/体态数据，使用 AI 生成专业的相学分析
- **中国传统相学**：结合《麻衣神相》等传统理论
- **赛博朋克风格**：古典智慧 + 科技感的独特表达
- **自动降级**：如果 OpenRouter API 失败，自动使用本地备份分析逻辑

### 3. 分析类型

#### 面相分析 (Face Analysis)
AI 会提供：
- 三停分析（天庭、鼻颧、地阁）
- 眼相、鼻相、嘴相、眉相分析
- 颧骨、下颌分析
- 面部对称性分析
- 综合性格分析
- 运势分析（早、中、晚年）
- 职业建议

#### 手相分析 (Hand Analysis)
AI 会提供：
- 手型分析（土/火/风/水四元素）
- 手指特征分析
- 职业建议

#### 体态分析 (Body/Posture Analysis)
AI 会提供：
- 姿态分析
- 气场能量分析
- 健康建议

### 4. 使用方式

系统会自动：
1. 检测用户的面部/手部/体态特征
2. 提取关键测量数据
3. 发送给 Gemini AI 进行分析
4. 返回个性化的相学报告

### 5. 数据流程

```
用户上传图片/启动摄像头
    ↓
MediaPipe 检测特征点
    ↓
计算测量指标 (metrics)
    ↓
发送给 OpenRouter API (Grok 4.1 Fast)
    ↓
AI 生成分析报告
    ↓
显示结果给用户
```

### 6. API 配置

当前使用的 OpenRouter 配置：
```typescript
{
  model: "x-ai/grok-4.1-fast:free",
  temperature: 0.8,      // 创造性：适中偏高
  max_tokens: 2048       // 最大输出长度
}
```

## 🔒 安全提示

**重要**：当前 API 密钥直接写在代码中，仅用于演示。生产环境中应该：
1. 将密钥移至环境变量
2. 使用后端代理调用 API
3. 定期轮换密钥

## 📊 成本估算

Grok 4.1 Fast 定价：
- **免费模型**：无需付费
- 通过 OpenRouter 平台调用
- 适合开发测试和小流量使用

## 🎯 下一步优化建议

1. **添加缓存**：相同特征的分析结果可以缓存
2. **批量分析**：支持一次性分析多个特征
3. **自定义提示词**：允许用户选择分析风格
4. **多语言支持**：支持英文等其他语言输出
5. **反馈机制**：用户可以对 AI 分析结果评分

## 🐛 已知问题

1. `fortuneService.ts` 中的本地备份函数存在类型错误，但不影响主要功能（因为优先使用 Gemini API）
2. 首次调用 API 时可能较慢（需要加载模型）

## 🔧 故障排除

如果 AI 分析失败：
- 检查网络连接（需要能访问 openrouter.ai）
- 确认 OpenRouter API 密钥有效
- 查看浏览器控制台错误信息
- 系统会自动降级使用本地分析
